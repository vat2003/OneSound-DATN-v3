import { Component, Input, Output, EventEmitter, ChangeDetectionStrategy } from '@angular/core';
import { BehaviorSubject, Subscription } from 'rxjs';
import { map } from 'rxjs/operators';
import { SHARE_BUTTONS } from 'ngx-sharebuttons';
import * as i0 from "@angular/core";
import * as i1 from "ngx-sharebuttons";
import * as i2 from "ngx-sharebuttons/button";
import * as i3 from "@angular/common";
import * as i4 from "./expand-button";
class ShareButtons {
    constructor(_share) {
        this._share = _share;
        this._state$ = new BehaviorSubject({
            includedButtons: [],
            excludedButtons: [],
            userButtons: [],
            selectedButtons: [],
            expanded: true,
            shownCount: Object.keys(SHARE_BUTTONS).length
        });
        this._configSub$ = Subscription.EMPTY;
        this.theme = this._share.config.theme;
        /** Sets the fb messenger redirect url to enable sharing on Messenger desktop */
        this.redirectUrl = this._share.config.redirectUrl;
        /** Show buttons icons */
        this.showIcon = true;
        /** Show buttons text */
        this.showText = false;
        /** Share dialog opened event */
        this.opened = new EventEmitter();
        /** Share dialog closed event */
        this.closed = new EventEmitter();
    }
    ngOnInit() {
        this.state$ = this._state$.pipe(map((state) => {
            // Use component include buttons, otherwise fallback to the global include buttons
            const includedButtons = state.includedButtons && state.includedButtons.length ? state.includedButtons : state.userButtons;
            const userButtons = state.excludedButtons ? includedButtons.filter((btn) => state.excludedButtons.indexOf(btn) < 0) : includedButtons;
            const selectedButtons = userButtons.slice(0, state.expanded ? userButtons.length : state.shownCount);
            return {
                userButtons,
                selectedButtons,
                expanded: state.expanded,
                shownCount: state.shownCount,
                moreIcon: state.moreIcon,
                lessIcon: state.lessIcon,
                moreAriaLabel: state.moreAriaLabel,
                lessAriaLabel: state.lessAriaLabel
            };
        }));
        // Subscribe to share buttons config changes, This updates the component whenever a new button is added
        this._configSub$ = this._share.config$.subscribe((config) => {
            // Use global include buttons, otherwise fallback to all buttons
            const includedButtons = config.include.length ? config.include : Object.keys(SHARE_BUTTONS);
            const userButtons = includedButtons.filter((btn) => config.exclude.indexOf(btn) < 0);
            this.updateState({
                userButtons,
                expanded: false,
                moreIcon: config.moreButtonIcon,
                lessIcon: config.lessButtonIcon,
                moreAriaLabel: config.moreButtonAriaLabel,
                lessAriaLabel: config.lessButtonAriaLabel
            });
        });
    }
    ngOnChanges(changes) {
        const shouldUpdate = (changes['include'] && changes['include'].currentValue !== changes['include'].previousValue) ||
            (changes['exclude'] && changes['exclude'].currentValue !== changes['exclude'].previousValue) ||
            (changes['show'] && changes['show'].currentValue !== changes['show'].previousValue);
        if (shouldUpdate) {
            this.updateState({
                includedButtons: this.include,
                excludedButtons: this.exclude,
                shownCount: this.show
            });
        }
    }
    ngOnDestroy() {
        this._configSub$.unsubscribe();
        this._state$.complete();
    }
    updateState(state) {
        this._state$.next({ ...this._state$.value, ...state });
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.0.2", ngImport: i0, type: ShareButtons, deps: [{ token: i1.ShareService }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.0.2", type: ShareButtons, selector: "share-buttons", inputs: { theme: "theme", include: "include", exclude: "exclude", show: "show", url: "url", title: "title", description: "description", image: "image", tags: "tags", redirectUrl: "redirectUrl", autoSetMeta: "autoSetMeta", showIcon: "showIcon", showText: "showText", disabled: "disabled" }, outputs: { opened: "opened", closed: "closed" }, usesOnChanges: true, ngImport: i0, template: "<div *ngIf=\"state$ | async; let state\" class=\"sb-group sb-{{theme}}\">\r\n  <share-button *ngFor=\"let button of state.selectedButtons\"\r\n                [button]=\"button\"\r\n                [theme]=\"theme\"\r\n                [url]=\"url\"\r\n                [title]=\"title\"\r\n                [description]=\"description\"\r\n                [image]=\"image\"\r\n                [tags]=\"tags\"\r\n                [redirectUrl]=\"redirectUrl\"\r\n                [autoSetMeta]=\"autoSetMeta\"\r\n                [showIcon]=\"showIcon\"\r\n                [showText]=\"showText\"\r\n                (opened)=\"opened.emit($event)\"\r\n                (closed)=\"closed.emit($event)\"\r\n                [disabled]=\"disabled\">\r\n  </share-button>\r\n  <expand-button *ngIf=\"state.shownCount < state.userButtons.length\"\r\n                 class=\"sb-button sb-{{theme}}\"\r\n                 [expanded]=\"state.expanded\"\r\n                 [moreIcon]=\"state.moreIcon\"\r\n                 [lessIcon]=\"state.lessIcon\"\r\n                 [moreAriaLabel]=\"state.moreAriaLabel\"\r\n                 [lessAriaLabel]=\"state.lessAriaLabel\"\r\n                 (toggle)=\"updateState({expanded: $event})\">\r\n  </expand-button>\r\n</div>\r\n", styles: [":host{display:inherit}.sb-group,.sb-button{display:inline-flex;align-items:flex-start}.sb-group{flex-wrap:wrap}\n"], dependencies: [{ kind: "component", type: i2.ShareButton, selector: "share-button", inputs: ["button", "url", "title", "description", "image", "tags", "redirectUrl", "autoSetMeta", "showIcon", "showText", "text", "icon", "theme", "disabled"], outputs: ["opened", "closed"] }, { kind: "directive", type: i3.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i4.ExpandButton, selector: "expand-button", inputs: ["moreIcon", "lessIcon", "expanded", "moreAriaLabel", "lessAriaLabel"], outputs: ["toggle"] }, { kind: "pipe", type: i3.AsyncPipe, name: "async" }], changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
export { ShareButtons };
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.0.2", ngImport: i0, type: ShareButtons, decorators: [{
            type: Component,
            args: [{ selector: 'share-buttons', changeDetection: ChangeDetectionStrategy.OnPush, template: "<div *ngIf=\"state$ | async; let state\" class=\"sb-group sb-{{theme}}\">\r\n  <share-button *ngFor=\"let button of state.selectedButtons\"\r\n                [button]=\"button\"\r\n                [theme]=\"theme\"\r\n                [url]=\"url\"\r\n                [title]=\"title\"\r\n                [description]=\"description\"\r\n                [image]=\"image\"\r\n                [tags]=\"tags\"\r\n                [redirectUrl]=\"redirectUrl\"\r\n                [autoSetMeta]=\"autoSetMeta\"\r\n                [showIcon]=\"showIcon\"\r\n                [showText]=\"showText\"\r\n                (opened)=\"opened.emit($event)\"\r\n                (closed)=\"closed.emit($event)\"\r\n                [disabled]=\"disabled\">\r\n  </share-button>\r\n  <expand-button *ngIf=\"state.shownCount < state.userButtons.length\"\r\n                 class=\"sb-button sb-{{theme}}\"\r\n                 [expanded]=\"state.expanded\"\r\n                 [moreIcon]=\"state.moreIcon\"\r\n                 [lessIcon]=\"state.lessIcon\"\r\n                 [moreAriaLabel]=\"state.moreAriaLabel\"\r\n                 [lessAriaLabel]=\"state.lessAriaLabel\"\r\n                 (toggle)=\"updateState({expanded: $event})\">\r\n  </expand-button>\r\n</div>\r\n", styles: [":host{display:inherit}.sb-group,.sb-button{display:inline-flex;align-items:flex-start}.sb-group{flex-wrap:wrap}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.ShareService }]; }, propDecorators: { theme: [{
                type: Input
            }], include: [{
                type: Input
            }], exclude: [{
                type: Input
            }], show: [{
                type: Input
            }], url: [{
                type: Input
            }], title: [{
                type: Input
            }], description: [{
                type: Input
            }], image: [{
                type: Input
            }], tags: [{
                type: Input
            }], redirectUrl: [{
                type: Input
            }], autoSetMeta: [{
                type: Input
            }], showIcon: [{
                type: Input
            }], showText: [{
                type: Input
            }], disabled: [{
                type: Input
            }], opened: [{
                type: Output
            }], closed: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2hhcmUtYnV0dG9ucy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Byb2plY3RzL25neC1zaGFyZWJ1dHRvbnMvYnV0dG9ucy9zcmMvc2hhcmUtYnV0dG9ucy50cyIsIi4uLy4uLy4uLy4uL3Byb2plY3RzL25neC1zaGFyZWJ1dHRvbnMvYnV0dG9ucy9zcmMvc2hhcmUtYnV0dG9ucy5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQ1QsS0FBSyxFQUNMLE1BQU0sRUFJTixZQUFZLEVBRVosdUJBQXVCLEVBQ3hCLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBYyxlQUFlLEVBQUUsWUFBWSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ2pFLE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUVyQyxPQUFPLEVBQW9DLGFBQWEsRUFBbUIsTUFBTSxrQkFBa0IsQ0FBQzs7Ozs7O0FBZXBHLE1BTWEsWUFBWTtJQTZEdkIsWUFBb0IsTUFBb0I7UUFBcEIsV0FBTSxHQUFOLE1BQU0sQ0FBYztRQTFEaEMsWUFBTyxHQUFHLElBQUksZUFBZSxDQUFlO1lBQ2xELGVBQWUsRUFBRSxFQUFFO1lBQ25CLGVBQWUsRUFBRSxFQUFFO1lBQ25CLFdBQVcsRUFBRSxFQUFFO1lBQ2YsZUFBZSxFQUFFLEVBQUU7WUFDbkIsUUFBUSxFQUFFLElBQUk7WUFDZCxVQUFVLEVBQUUsTUFBTSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQyxNQUFNO1NBQzlDLENBQUMsQ0FBQztRQUVLLGdCQUFXLEdBQUcsWUFBWSxDQUFDLEtBQUssQ0FBQztRQUVoQyxVQUFLLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDO1FBMEIxQyxnRkFBZ0Y7UUFDdkUsZ0JBQVcsR0FBVyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUM7UUFLOUQseUJBQXlCO1FBQ2hCLGFBQVEsR0FBRyxJQUFJLENBQUM7UUFFekIsd0JBQXdCO1FBQ2YsYUFBUSxHQUFHLEtBQUssQ0FBQztRQUsxQixnQ0FBZ0M7UUFDdEIsV0FBTSxHQUFHLElBQUksWUFBWSxFQUFVLENBQUM7UUFFOUMsZ0NBQWdDO1FBQ3RCLFdBQU0sR0FBRyxJQUFJLFlBQVksRUFBVSxDQUFDO0lBRzlDLENBQUM7SUFFRCxRQUFRO1FBQ04sSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FDN0IsR0FBRyxDQUFDLENBQUMsS0FBbUIsRUFBRSxFQUFFO1lBQzFCLGtGQUFrRjtZQUNsRixNQUFNLGVBQWUsR0FBRyxLQUFLLENBQUMsZUFBZSxJQUFJLEtBQUssQ0FBQyxlQUFlLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDO1lBQzFILE1BQU0sV0FBVyxHQUFHLEtBQUssQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFvQixFQUFFLEVBQUUsQ0FBQyxLQUFLLENBQUMsZUFBZSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsZUFBZSxDQUFDO1lBQ3ZKLE1BQU0sZUFBZSxHQUFHLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUNyRyxPQUFPO2dCQUNMLFdBQVc7Z0JBQ1gsZUFBZTtnQkFDZixRQUFRLEVBQUUsS0FBSyxDQUFDLFFBQVE7Z0JBQ3hCLFVBQVUsRUFBRSxLQUFLLENBQUMsVUFBVTtnQkFDNUIsUUFBUSxFQUFFLEtBQUssQ0FBQyxRQUFRO2dCQUN4QixRQUFRLEVBQUUsS0FBSyxDQUFDLFFBQVE7Z0JBQ3hCLGFBQWEsRUFBRSxLQUFLLENBQUMsYUFBYTtnQkFDbEMsYUFBYSxFQUFFLEtBQUssQ0FBQyxhQUFhO2FBQ25DLENBQUM7UUFDSixDQUFDLENBQUMsQ0FDSCxDQUFDO1FBRUYsdUdBQXVHO1FBQ3ZHLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUMsTUFBMEIsRUFBRSxFQUFFO1lBQzlFLGdFQUFnRTtZQUNoRSxNQUFNLGVBQWUsR0FBc0IsTUFBTSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFzQixDQUFDO1lBQ3BJLE1BQU0sV0FBVyxHQUFzQixlQUFlLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBb0IsRUFBRSxFQUFFLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDekgsSUFBSSxDQUFDLFdBQVcsQ0FBQztnQkFDZixXQUFXO2dCQUNYLFFBQVEsRUFBRSxLQUFLO2dCQUNmLFFBQVEsRUFBRSxNQUFNLENBQUMsY0FBYztnQkFDL0IsUUFBUSxFQUFFLE1BQU0sQ0FBQyxjQUFjO2dCQUMvQixhQUFhLEVBQUUsTUFBTSxDQUFDLG1CQUFtQjtnQkFDekMsYUFBYSxFQUFFLE1BQU0sQ0FBQyxtQkFBbUI7YUFDMUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsV0FBVyxDQUFDLE9BQXNCO1FBQ2hDLE1BQU0sWUFBWSxHQUNoQixDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsSUFBSSxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUMsWUFBWSxLQUFLLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyxhQUFhLENBQUM7WUFDNUYsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLElBQUksT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDLFlBQVksS0FBSyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUMsYUFBYSxDQUFDO1lBQzVGLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxZQUFZLEtBQUssT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBRXRGLElBQUksWUFBWSxFQUFFO1lBQ2hCLElBQUksQ0FBQyxXQUFXLENBQUM7Z0JBQ2YsZUFBZSxFQUFFLElBQUksQ0FBQyxPQUFPO2dCQUM3QixlQUFlLEVBQUUsSUFBSSxDQUFDLE9BQU87Z0JBQzdCLFVBQVUsRUFBRSxJQUFJLENBQUMsSUFBSTthQUN0QixDQUFDLENBQUM7U0FDSjtJQUNILENBQUM7SUFFRCxXQUFXO1FBQ1QsSUFBSSxDQUFDLFdBQVcsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUMvQixJQUFJLENBQUMsT0FBTyxDQUFDLFFBQVEsRUFBRSxDQUFDO0lBQzFCLENBQUM7SUFFRCxXQUFXLENBQUMsS0FBbUI7UUFDN0IsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBQyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLEdBQUcsS0FBSyxFQUFDLENBQUMsQ0FBQztJQUN2RCxDQUFDOzhHQTFIVSxZQUFZO2tHQUFaLFlBQVksNlpDbkN6Qiw0dUNBMkJBOztTRFFhLFlBQVk7MkZBQVosWUFBWTtrQkFOeEIsU0FBUzsrQkFDRSxlQUFlLG1CQUdSLHVCQUF1QixDQUFDLE1BQU07bUdBZ0J0QyxLQUFLO3NCQUFiLEtBQUs7Z0JBR0csT0FBTztzQkFBZixLQUFLO2dCQUdHLE9BQU87c0JBQWYsS0FBSztnQkFHRyxJQUFJO3NCQUFaLEtBQUs7Z0JBR0csR0FBRztzQkFBWCxLQUFLO2dCQUdHLEtBQUs7c0JBQWIsS0FBSztnQkFHRyxXQUFXO3NCQUFuQixLQUFLO2dCQUdHLEtBQUs7c0JBQWIsS0FBSztnQkFHRyxJQUFJO3NCQUFaLEtBQUs7Z0JBR0csV0FBVztzQkFBbkIsS0FBSztnQkFHRyxXQUFXO3NCQUFuQixLQUFLO2dCQUdHLFFBQVE7c0JBQWhCLEtBQUs7Z0JBR0csUUFBUTtzQkFBaEIsS0FBSztnQkFHRyxRQUFRO3NCQUFoQixLQUFLO2dCQUdJLE1BQU07c0JBQWYsTUFBTTtnQkFHRyxNQUFNO3NCQUFmLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gIENvbXBvbmVudCxcclxuICBJbnB1dCxcclxuICBPdXRwdXQsXHJcbiAgT25Jbml0LFxyXG4gIE9uQ2hhbmdlcyxcclxuICBPbkRlc3Ryb3ksXHJcbiAgRXZlbnRFbWl0dGVyLFxyXG4gIFNpbXBsZUNoYW5nZXMsXHJcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3lcclxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgQmVoYXZpb3JTdWJqZWN0LCBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgbWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5cclxuaW1wb3J0IHsgU2hhcmVTZXJ2aWNlLCBTaGFyZUJ1dHRvbnNDb25maWcsIFNIQVJFX0JVVFRPTlMsIHNoYXJlQnV0dG9uTmFtZSB9IGZyb20gJ25neC1zaGFyZWJ1dHRvbnMnO1xyXG5cclxuaW50ZXJmYWNlIEJ1dHRvbnNTdGF0ZSB7XHJcbiAgaW5jbHVkZWRCdXR0b25zPzogc2hhcmVCdXR0b25OYW1lW107XHJcbiAgZXhjbHVkZWRCdXR0b25zPzogc2hhcmVCdXR0b25OYW1lW107XHJcbiAgdXNlckJ1dHRvbnM/OiBzaGFyZUJ1dHRvbk5hbWVbXTtcclxuICBzZWxlY3RlZEJ1dHRvbnM/OiBzaGFyZUJ1dHRvbk5hbWVbXTtcclxuICBleHBhbmRlZD86IGJvb2xlYW47XHJcbiAgc2hvd25Db3VudD86IG51bWJlcjtcclxuICBtb3JlSWNvbj86IGFueTtcclxuICBsZXNzSWNvbj86IGFueTtcclxuICBtb3JlQXJpYUxhYmVsPzogc3RyaW5nO1xyXG4gIGxlc3NBcmlhTGFiZWw/OiBzdHJpbmc7XHJcbn1cclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnc2hhcmUtYnV0dG9ucycsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL3NoYXJlLWJ1dHRvbnMuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vc2hhcmUtYnV0dG9ucy5zY3NzJ10sXHJcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2hcclxufSlcclxuZXhwb3J0IGNsYXNzIFNoYXJlQnV0dG9ucyBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzLCBPbkRlc3Ryb3kge1xyXG5cclxuICBzdGF0ZSQ6IE9ic2VydmFibGU8QnV0dG9uc1N0YXRlPjtcclxuICBwcml2YXRlIF9zdGF0ZSQgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PEJ1dHRvbnNTdGF0ZT4oe1xyXG4gICAgaW5jbHVkZWRCdXR0b25zOiBbXSxcclxuICAgIGV4Y2x1ZGVkQnV0dG9uczogW10sXHJcbiAgICB1c2VyQnV0dG9uczogW10sXHJcbiAgICBzZWxlY3RlZEJ1dHRvbnM6IFtdLFxyXG4gICAgZXhwYW5kZWQ6IHRydWUsXHJcbiAgICBzaG93bkNvdW50OiBPYmplY3Qua2V5cyhTSEFSRV9CVVRUT05TKS5sZW5ndGhcclxuICB9KTtcclxuXHJcbiAgcHJpdmF0ZSBfY29uZmlnU3ViJCA9IFN1YnNjcmlwdGlvbi5FTVBUWTtcclxuXHJcbiAgQElucHV0KCkgdGhlbWUgPSB0aGlzLl9zaGFyZS5jb25maWcudGhlbWU7XHJcblxyXG4gIC8qKiBBcnJheSBvZiBpbmNsdWRlZCBidXR0b25zICovXHJcbiAgQElucHV0KCkgaW5jbHVkZTogc2hhcmVCdXR0b25OYW1lW107XHJcblxyXG4gIC8qKiBBcnJheSBvZiBleGNsdWRlZCBidXR0b25zICovXHJcbiAgQElucHV0KCkgZXhjbHVkZTogc2hhcmVCdXR0b25OYW1lW107XHJcblxyXG4gIC8qKiBOdW1iZXJzIG9mIGJ1dHRvbnMgdG8gc2hvdyAqL1xyXG4gIEBJbnB1dCgpIHNob3c6IG51bWJlcjtcclxuXHJcbiAgLyoqIFRoZSBzaGFyaW5nIGxpbmsgKi9cclxuICBASW5wdXQoKSB1cmw6IHN0cmluZztcclxuXHJcbiAgLyoqIFRoZSB0aXRsZSBwYXJhbWV0ZXIgKi9cclxuICBASW5wdXQoKSB0aXRsZTogc3RyaW5nO1xyXG5cclxuICAvKiogVGhlIGRlc2NyaXB0aW9uIHBhcmFtZXRlciAqL1xyXG4gIEBJbnB1dCgpIGRlc2NyaXB0aW9uOiBzdHJpbmc7XHJcblxyXG4gIC8qKiBUaGUgaW1hZ2UgcGFyYW1ldGVyIGZvciBzaGFyaW5nIG9uIFBpbnRlcmVzdCAqL1xyXG4gIEBJbnB1dCgpIGltYWdlOiBzdHJpbmc7XHJcblxyXG4gIC8qKiBUaGUgdGFncyBwYXJhbWV0ZXIgZm9yIHNoYXJpbmcgb24gVHdpdHRlciBhbmQgVHVtYmxyICovXHJcbiAgQElucHV0KCkgdGFnczogc3RyaW5nO1xyXG5cclxuICAvKiogU2V0cyB0aGUgZmIgbWVzc2VuZ2VyIHJlZGlyZWN0IHVybCB0byBlbmFibGUgc2hhcmluZyBvbiBNZXNzZW5nZXIgZGVza3RvcCAqL1xyXG4gIEBJbnB1dCgpIHJlZGlyZWN0VXJsOiBzdHJpbmcgPSB0aGlzLl9zaGFyZS5jb25maWcucmVkaXJlY3RVcmw7XHJcblxyXG4gIC8qKiBTZXRzIG1ldGEgdGFncyBmcm9tIGRvY3VtZW50IGhlYWQsIHVzZWZ1bCB3aGVuIFNFTyBpcyBhdmFpbGFibGUgKi9cclxuICBASW5wdXQoKSBhdXRvU2V0TWV0YTogYm9vbGVhbjtcclxuXHJcbiAgLyoqIFNob3cgYnV0dG9ucyBpY29ucyAqL1xyXG4gIEBJbnB1dCgpIHNob3dJY29uID0gdHJ1ZTtcclxuXHJcbiAgLyoqIFNob3cgYnV0dG9ucyB0ZXh0ICovXHJcbiAgQElucHV0KCkgc2hvd1RleHQgPSBmYWxzZTtcclxuXHJcbiAgLyoqIEEgZmxhZyB0aGF0IGluZGljYXRlcyBpZiB0aGUgYnV0dG9uJ3MgY2xpY2sgaXMgZGlzYWJsZWQgKi9cclxuICBASW5wdXQoKSBkaXNhYmxlZDogYm9vbGVhbjtcclxuXHJcbiAgLyoqIFNoYXJlIGRpYWxvZyBvcGVuZWQgZXZlbnQgKi9cclxuICBAT3V0cHV0KCkgb3BlbmVkID0gbmV3IEV2ZW50RW1pdHRlcjxzdHJpbmc+KCk7XHJcblxyXG4gIC8qKiBTaGFyZSBkaWFsb2cgY2xvc2VkIGV2ZW50ICovXHJcbiAgQE91dHB1dCgpIGNsb3NlZCA9IG5ldyBFdmVudEVtaXR0ZXI8c3RyaW5nPigpO1xyXG5cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIF9zaGFyZTogU2hhcmVTZXJ2aWNlKSB7XHJcbiAgfVxyXG5cclxuICBuZ09uSW5pdCgpIHtcclxuICAgIHRoaXMuc3RhdGUkID0gdGhpcy5fc3RhdGUkLnBpcGUoXHJcbiAgICAgIG1hcCgoc3RhdGU6IEJ1dHRvbnNTdGF0ZSkgPT4ge1xyXG4gICAgICAgIC8vIFVzZSBjb21wb25lbnQgaW5jbHVkZSBidXR0b25zLCBvdGhlcndpc2UgZmFsbGJhY2sgdG8gdGhlIGdsb2JhbCBpbmNsdWRlIGJ1dHRvbnNcclxuICAgICAgICBjb25zdCBpbmNsdWRlZEJ1dHRvbnMgPSBzdGF0ZS5pbmNsdWRlZEJ1dHRvbnMgJiYgc3RhdGUuaW5jbHVkZWRCdXR0b25zLmxlbmd0aCA/IHN0YXRlLmluY2x1ZGVkQnV0dG9ucyA6IHN0YXRlLnVzZXJCdXR0b25zO1xyXG4gICAgICAgIGNvbnN0IHVzZXJCdXR0b25zID0gc3RhdGUuZXhjbHVkZWRCdXR0b25zID8gaW5jbHVkZWRCdXR0b25zLmZpbHRlcigoYnRuOiBzaGFyZUJ1dHRvbk5hbWUpID0+IHN0YXRlLmV4Y2x1ZGVkQnV0dG9ucy5pbmRleE9mKGJ0bikgPCAwKSA6IGluY2x1ZGVkQnV0dG9ucztcclxuICAgICAgICBjb25zdCBzZWxlY3RlZEJ1dHRvbnMgPSB1c2VyQnV0dG9ucy5zbGljZSgwLCBzdGF0ZS5leHBhbmRlZCA/IHVzZXJCdXR0b25zLmxlbmd0aCA6IHN0YXRlLnNob3duQ291bnQpO1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICB1c2VyQnV0dG9ucyxcclxuICAgICAgICAgIHNlbGVjdGVkQnV0dG9ucyxcclxuICAgICAgICAgIGV4cGFuZGVkOiBzdGF0ZS5leHBhbmRlZCxcclxuICAgICAgICAgIHNob3duQ291bnQ6IHN0YXRlLnNob3duQ291bnQsXHJcbiAgICAgICAgICBtb3JlSWNvbjogc3RhdGUubW9yZUljb24sXHJcbiAgICAgICAgICBsZXNzSWNvbjogc3RhdGUubGVzc0ljb24sXHJcbiAgICAgICAgICBtb3JlQXJpYUxhYmVsOiBzdGF0ZS5tb3JlQXJpYUxhYmVsLFxyXG4gICAgICAgICAgbGVzc0FyaWFMYWJlbDogc3RhdGUubGVzc0FyaWFMYWJlbFxyXG4gICAgICAgIH07XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG5cclxuICAgIC8vIFN1YnNjcmliZSB0byBzaGFyZSBidXR0b25zIGNvbmZpZyBjaGFuZ2VzLCBUaGlzIHVwZGF0ZXMgdGhlIGNvbXBvbmVudCB3aGVuZXZlciBhIG5ldyBidXR0b24gaXMgYWRkZWRcclxuICAgIHRoaXMuX2NvbmZpZ1N1YiQgPSB0aGlzLl9zaGFyZS5jb25maWckLnN1YnNjcmliZSgoY29uZmlnOiBTaGFyZUJ1dHRvbnNDb25maWcpID0+IHtcclxuICAgICAgLy8gVXNlIGdsb2JhbCBpbmNsdWRlIGJ1dHRvbnMsIG90aGVyd2lzZSBmYWxsYmFjayB0byBhbGwgYnV0dG9uc1xyXG4gICAgICBjb25zdCBpbmNsdWRlZEJ1dHRvbnM6IHNoYXJlQnV0dG9uTmFtZVtdID0gY29uZmlnLmluY2x1ZGUubGVuZ3RoID8gY29uZmlnLmluY2x1ZGUgOiBPYmplY3Qua2V5cyhTSEFSRV9CVVRUT05TKSBhcyBzaGFyZUJ1dHRvbk5hbWVbXTtcclxuICAgICAgY29uc3QgdXNlckJ1dHRvbnM6IHNoYXJlQnV0dG9uTmFtZVtdID0gaW5jbHVkZWRCdXR0b25zLmZpbHRlcigoYnRuOiBzaGFyZUJ1dHRvbk5hbWUpID0+IGNvbmZpZy5leGNsdWRlLmluZGV4T2YoYnRuKSA8IDApO1xyXG4gICAgICB0aGlzLnVwZGF0ZVN0YXRlKHtcclxuICAgICAgICB1c2VyQnV0dG9ucyxcclxuICAgICAgICBleHBhbmRlZDogZmFsc2UsXHJcbiAgICAgICAgbW9yZUljb246IGNvbmZpZy5tb3JlQnV0dG9uSWNvbixcclxuICAgICAgICBsZXNzSWNvbjogY29uZmlnLmxlc3NCdXR0b25JY29uLFxyXG4gICAgICAgIG1vcmVBcmlhTGFiZWw6IGNvbmZpZy5tb3JlQnV0dG9uQXJpYUxhYmVsLFxyXG4gICAgICAgIGxlc3NBcmlhTGFiZWw6IGNvbmZpZy5sZXNzQnV0dG9uQXJpYUxhYmVsXHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XHJcbiAgICBjb25zdCBzaG91bGRVcGRhdGUgPVxyXG4gICAgICAoY2hhbmdlc1snaW5jbHVkZSddICYmIGNoYW5nZXNbJ2luY2x1ZGUnXS5jdXJyZW50VmFsdWUgIT09IGNoYW5nZXNbJ2luY2x1ZGUnXS5wcmV2aW91c1ZhbHVlKSB8fFxyXG4gICAgICAoY2hhbmdlc1snZXhjbHVkZSddICYmIGNoYW5nZXNbJ2V4Y2x1ZGUnXS5jdXJyZW50VmFsdWUgIT09IGNoYW5nZXNbJ2V4Y2x1ZGUnXS5wcmV2aW91c1ZhbHVlKSB8fFxyXG4gICAgICAoY2hhbmdlc1snc2hvdyddICYmIGNoYW5nZXNbJ3Nob3cnXS5jdXJyZW50VmFsdWUgIT09IGNoYW5nZXNbJ3Nob3cnXS5wcmV2aW91c1ZhbHVlKTtcclxuXHJcbiAgICBpZiAoc2hvdWxkVXBkYXRlKSB7XHJcbiAgICAgIHRoaXMudXBkYXRlU3RhdGUoe1xyXG4gICAgICAgIGluY2x1ZGVkQnV0dG9uczogdGhpcy5pbmNsdWRlLFxyXG4gICAgICAgIGV4Y2x1ZGVkQnV0dG9uczogdGhpcy5leGNsdWRlLFxyXG4gICAgICAgIHNob3duQ291bnQ6IHRoaXMuc2hvd1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIG5nT25EZXN0cm95KCkge1xyXG4gICAgdGhpcy5fY29uZmlnU3ViJC51bnN1YnNjcmliZSgpO1xyXG4gICAgdGhpcy5fc3RhdGUkLmNvbXBsZXRlKCk7XHJcbiAgfVxyXG5cclxuICB1cGRhdGVTdGF0ZShzdGF0ZTogQnV0dG9uc1N0YXRlKSB7XHJcbiAgICB0aGlzLl9zdGF0ZSQubmV4dCh7Li4udGhpcy5fc3RhdGUkLnZhbHVlLCAuLi5zdGF0ZX0pO1xyXG4gIH1cclxuXHJcbn1cclxuXHJcbi8qKlxyXG4gKiBFeHBsYW5hdGlvbiBvZiB0aGUgYWJvdmUgY29kZTpcclxuICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbiBJbmNsdWRlIGJ1dHRvbnM6IGluY2x1ZGVzIG9ubHkgd2FudGVkIGJ1dHRvbnMgYW5kIGV4Y2x1ZGVzIHRoZSByZXN0XHJcbiBFeGNsdWRlIGJ1dHRvbnM6IGV4Y2x1ZGVzIG9ubHkgdGhlIHVud2FudGVkIGJ1dHRvbnNcclxuIFVzZXIgYnV0dG9ucyA9IEluY2x1ZGUgYnV0dG9ucyAtIGV4Y2x1ZGUgYnV0dG9uc1xyXG4gU2VsZWN0ZWQgQnV0dG9ucyA9IFVzZXIgYnV0dG9ucyBbc2hvd24gbnVtYmVyXVxyXG4gKi9cclxuIiwiPGRpdiAqbmdJZj1cInN0YXRlJCB8IGFzeW5jOyBsZXQgc3RhdGVcIiBjbGFzcz1cInNiLWdyb3VwIHNiLXt7dGhlbWV9fVwiPlxyXG4gIDxzaGFyZS1idXR0b24gKm5nRm9yPVwibGV0IGJ1dHRvbiBvZiBzdGF0ZS5zZWxlY3RlZEJ1dHRvbnNcIlxyXG4gICAgICAgICAgICAgICAgW2J1dHRvbl09XCJidXR0b25cIlxyXG4gICAgICAgICAgICAgICAgW3RoZW1lXT1cInRoZW1lXCJcclxuICAgICAgICAgICAgICAgIFt1cmxdPVwidXJsXCJcclxuICAgICAgICAgICAgICAgIFt0aXRsZV09XCJ0aXRsZVwiXHJcbiAgICAgICAgICAgICAgICBbZGVzY3JpcHRpb25dPVwiZGVzY3JpcHRpb25cIlxyXG4gICAgICAgICAgICAgICAgW2ltYWdlXT1cImltYWdlXCJcclxuICAgICAgICAgICAgICAgIFt0YWdzXT1cInRhZ3NcIlxyXG4gICAgICAgICAgICAgICAgW3JlZGlyZWN0VXJsXT1cInJlZGlyZWN0VXJsXCJcclxuICAgICAgICAgICAgICAgIFthdXRvU2V0TWV0YV09XCJhdXRvU2V0TWV0YVwiXHJcbiAgICAgICAgICAgICAgICBbc2hvd0ljb25dPVwic2hvd0ljb25cIlxyXG4gICAgICAgICAgICAgICAgW3Nob3dUZXh0XT1cInNob3dUZXh0XCJcclxuICAgICAgICAgICAgICAgIChvcGVuZWQpPVwib3BlbmVkLmVtaXQoJGV2ZW50KVwiXHJcbiAgICAgICAgICAgICAgICAoY2xvc2VkKT1cImNsb3NlZC5lbWl0KCRldmVudClcIlxyXG4gICAgICAgICAgICAgICAgW2Rpc2FibGVkXT1cImRpc2FibGVkXCI+XHJcbiAgPC9zaGFyZS1idXR0b24+XHJcbiAgPGV4cGFuZC1idXR0b24gKm5nSWY9XCJzdGF0ZS5zaG93bkNvdW50IDwgc3RhdGUudXNlckJ1dHRvbnMubGVuZ3RoXCJcclxuICAgICAgICAgICAgICAgICBjbGFzcz1cInNiLWJ1dHRvbiBzYi17e3RoZW1lfX1cIlxyXG4gICAgICAgICAgICAgICAgIFtleHBhbmRlZF09XCJzdGF0ZS5leHBhbmRlZFwiXHJcbiAgICAgICAgICAgICAgICAgW21vcmVJY29uXT1cInN0YXRlLm1vcmVJY29uXCJcclxuICAgICAgICAgICAgICAgICBbbGVzc0ljb25dPVwic3RhdGUubGVzc0ljb25cIlxyXG4gICAgICAgICAgICAgICAgIFttb3JlQXJpYUxhYmVsXT1cInN0YXRlLm1vcmVBcmlhTGFiZWxcIlxyXG4gICAgICAgICAgICAgICAgIFtsZXNzQXJpYUxhYmVsXT1cInN0YXRlLmxlc3NBcmlhTGFiZWxcIlxyXG4gICAgICAgICAgICAgICAgICh0b2dnbGUpPVwidXBkYXRlU3RhdGUoe2V4cGFuZGVkOiAkZXZlbnR9KVwiPlxyXG4gIDwvZXhwYW5kLWJ1dHRvbj5cclxuPC9kaXY+XHJcbiJdfQ==