import { Directive, Input, Output, HostListener, Inject, EventEmitter } from '@angular/core';
import { DOCUMENT } from '@angular/common';
import { EMPTY, Observable, Subject } from 'rxjs';
import { takeUntil, tap } from 'rxjs/operators';
import { SharerMethod } from './share.models';
import { getValidUrl } from './utils';
import * as i0 from "@angular/core";
import * as i1 from "@angular/platform-browser";
import * as i2 from "@angular/cdk/platform";
import * as i3 from "@angular/cdk/clipboard";
import * as i4 from "./share.service";
class ShareDirective {
    constructor(_el, _meta, _platform, _clipboard, _share, _cd, _document) {
        this._meta = _meta;
        this._platform = _platform;
        this._clipboard = _clipboard;
        this._share = _share;
        this._cd = _cd;
        this._document = _document;
        /** Stream that emits when button is destroyed */
        this._destroyed = new Subject();
        /** Stream that emit when share button need to be updated */
        this._updater = new Subject();
        /** Set meta tags from document head, useful when SEO is supported */
        this.autoSetMeta = this._share.config.autoSetMeta;
        /** Sharing link */
        this.url = this._share.config.url;
        /** Sets the title parameter */
        this.title = this._share.config.title;
        /** Sets the description parameter */
        this.description = this._share.config.description;
        /** Sets the image parameter for sharing on Pinterest */
        this.image = this._share.config.image;
        /** Sets the tags parameter for sharing on Twitter and Tumblr */
        this.tags = this._share.config.tags;
        /** Sets the fb messenger redirect url to enable sharing on Messenger desktop */
        this.redirectUrl = this._share.config.redirectUrl;
        /** Stream that emits when share dialog is opened */
        this.opened = new EventEmitter();
        /** Stream that emits when share dialog is closed */
        this.closed = new EventEmitter();
        this._el = _el.nativeElement;
    }
    /**
     * Share the link
     */
    share() {
        // Avoid SSR error
        if (this._platform.isBrowser && this.shareButton) {
            // Prepare sharer url params
            const params = this.autoSetMeta ? this.getParamsFromMetaTags() : this.getParamsFromInputs();
            // Prepare share button click
            const click = this.shareButton.share ? this.open(params) : this.shareButton.func({
                params,
                data: this.shareButton.data,
                clipboard: this._clipboard,
                updater: this._updater
            });
            click.pipe(takeUntil(this._destroyed)).subscribe();
        }
        else {
            console.warn(`${this.text} button is not compatible on this Platform`);
        }
    }
    ngOnInit() {
        // This stream is mainly used to update the copy button text and icon when it is being clicked
        this._updater.pipe(tap((data) => {
            this.icon = data.icon;
            this.text = data.text;
            this._el.style.pointerEvents = data.disabled ? 'none' : 'auto';
            this._cd.markForCheck();
        }), takeUntil(this._destroyed)).subscribe();
    }
    ngOnChanges(changes) {
        // Avoid SSR error
        if (this._platform.isBrowser) {
            // Create share button
            if (this._shareButtonChanged(changes.shareButtonName)) {
                this._createShareButton();
            }
            // Prepare share url
            if (this._urlChanged(changes.url)) {
                this.url = getValidUrl(this.autoSetMeta
                    ? this.url || this._getMetaTagContent('og:url')
                    : this.url, this._document.defaultView.location.href);
            }
        }
    }
    ngOnDestroy() {
        this._destroyed.next();
        this._destroyed.complete();
    }
    _createShareButton() {
        const button = this._share.config.prop[this.shareButtonName];
        if (button) {
            // Set share button properties
            this.shareButton = button;
            // Remove previous button class
            this._el.classList.remove(`sb-${this._buttonClass}`);
            // Add new button class
            this._el.classList.add(`sb-${this.shareButtonName}`);
            // Set button css color variable
            this._el.style.setProperty('--button-color', this.shareButton.color);
            // Keep a copy of the class for future replacement
            this._buttonClass = this.shareButtonName;
            this.color = this.shareButton.color;
            this.text = this.shareButton.text;
            this.icon = this.shareButton.icon;
            // Set aria-label attribute
            this._el.setAttribute('aria-label', button.ariaLabel);
        }
        else {
            console.error(`[ShareButtons]: The share button '${this.shareButtonName}' does not exist!`);
        }
    }
    /**
     * Get meta tag content
     */
    _getMetaTagContent(key) {
        const metaUsingProperty = this._meta.getTag(`property="${key}"`);
        if (metaUsingProperty) {
            return metaUsingProperty.getAttribute('content');
        }
        const metaUsingName = this._meta.getTag(`name="${key}"`);
        if (metaUsingName) {
            return metaUsingName.getAttribute('content');
        }
    }
    _shareButtonChanged(change) {
        return change && (change.firstChange || change.previousValue !== change.currentValue);
    }
    _urlChanged(change) {
        return !this.url || (change && change.previousValue !== change.currentValue);
    }
    /**
     * Get share params from meta tags first and fallback to user inputs
     */
    getParamsFromMetaTags() {
        return {
            url: this.url,
            title: this.title || this._getMetaTagContent('og:title'),
            description: this.description || this._getMetaTagContent('og:description'),
            image: this.image || this._getMetaTagContent('og:image'),
            via: this._share.config.twitterAccount,
            tags: this.tags,
            appId: this._share.config.appId || this._getMetaTagContent('fb:app_id'),
            redirectUrl: this.redirectUrl || this.url
        };
    }
    /**
     * Get share params from user inputs
     */
    getParamsFromInputs() {
        return {
            url: this.url,
            title: this.title,
            description: this.description,
            image: this.image,
            tags: this.tags,
            via: this._share.config.twitterAccount,
            appId: this._share.config.appId,
            redirectUrl: this.redirectUrl || this.url
        };
    }
    open(params) {
        // Set sharer link based on user's device
        let sharerLink;
        if (this._platform.IOS && this.shareButton.share.ios) {
            sharerLink = this.shareButton.share.ios;
        }
        else if (this._platform.ANDROID && this.shareButton.share.android) {
            sharerLink = this.shareButton.share.android;
        }
        else {
            sharerLink = this.shareButton.share.desktop;
        }
        if (sharerLink) {
            // Set sharer link params
            this._finalUrl = sharerLink + this._serializeParams(params);
            // Log the sharer link in debug mode
            if (this._share.config.debug) {
                console.log('[DEBUG SHARE BUTTON]: ', this._finalUrl);
            }
            // Open the share window
            // There are two methods available for opening the share window:
            // 1. Using a real anchor
            // 2. Using window.open
            const sharerMethod = this.shareButton.method || this._share.config.sharerMethod;
            const sharerTarget = this.shareButton.target || this._share.config.sharerTarget;
            switch (sharerMethod) {
                case SharerMethod.Anchor:
                    const linkElement = this._document.createElement('a');
                    // Make it open in a new tab/window (depends on user's browser configuration)
                    linkElement.setAttribute('target', sharerTarget);
                    // Prevent security vulnerability https://medium.com/@jitbit/target-blank-the-most-underestimated-vulnerability-ever-96e328301f4c
                    linkElement.setAttribute('rel', 'noopener noreferrer');
                    linkElement.href = this._finalUrl;
                    linkElement.click();
                    linkElement.remove();
                    break;
                case SharerMethod.Window:
                    // Open link using Window object
                    const openWindow = this._share.config.windowObj[this._share.config.windowFuncName];
                    const popUpWindow = openWindow(this._finalUrl, sharerTarget, this._share.windowSize);
                    // Prevent security vulnerability https://medium.com/@jitbit/target-blank-the-most-underestimated-vulnerability-ever-96e328301f4c
                    this._share.config.windowObj.opener = null;
                    // Resolve when share dialog is closed
                    if (popUpWindow) {
                        return new Observable((sub) => {
                            const pollTimer = this._document.defaultView.setInterval(() => {
                                if (popUpWindow.closed) {
                                    this._document.defaultView.clearInterval(pollTimer);
                                    // Emit when share windows is closed
                                    this.closed.emit(this.shareButtonName);
                                    sub.next();
                                    sub.complete();
                                }
                            }, 200);
                        });
                    }
                    break;
            }
            // Emit when share window is opened
            this.opened.emit(this.shareButtonName);
        }
        return EMPTY;
    }
    _serializeParams(params) {
        return Object.entries(this.shareButton.params)
            .map(([key, value]) => {
            // Check if share button param has a map function
            const paramFunc = this.shareButton.paramsFunc ? this.shareButton.paramsFunc[key] : null;
            if (params[key] || paramFunc) {
                const paramValue = paramFunc ? paramFunc(params) : params[key];
                return `${value}=${encodeURIComponent(paramValue)}`;
            }
            return '';
        })
            .filter(urlParam => urlParam !== '')
            .join('&');
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.0.2", ngImport: i0, type: ShareDirective, deps: [{ token: i0.ElementRef }, { token: i1.Meta }, { token: i2.Platform }, { token: i3.Clipboard }, { token: i4.ShareService }, { token: i0.ChangeDetectorRef }, { token: DOCUMENT }], target: i0.ɵɵFactoryTarget.Directive }); }
    static { this.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "14.0.0", version: "16.0.2", type: ShareDirective, selector: "[shareButton]", inputs: { shareButtonName: ["shareButton", "shareButtonName"], autoSetMeta: "autoSetMeta", url: "url", title: "title", description: "description", image: "image", tags: "tags", redirectUrl: "redirectUrl" }, outputs: { opened: "opened", closed: "closed" }, host: { listeners: { "click": "share()" } }, exportAs: ["shareButton"], usesOnChanges: true, ngImport: i0 }); }
}
export { ShareDirective };
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.0.2", ngImport: i0, type: ShareDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: '[shareButton]',
                    exportAs: 'shareButton'
                }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: i1.Meta }, { type: i2.Platform }, { type: i3.Clipboard }, { type: i4.ShareService }, { type: i0.ChangeDetectorRef }, { type: undefined, decorators: [{
                    type: Inject,
                    args: [DOCUMENT]
                }] }]; }, propDecorators: { shareButtonName: [{
                type: Input,
                args: ['shareButton']
            }], autoSetMeta: [{
                type: Input
            }], url: [{
                type: Input
            }], title: [{
                type: Input
            }], description: [{
                type: Input
            }], image: [{
                type: Input
            }], tags: [{
                type: Input
            }], redirectUrl: [{
                type: Input
            }], opened: [{
                type: Output
            }], closed: [{
                type: Output
            }], share: [{
                type: HostListener,
                args: ['click']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2hhcmUtYnV0dG9uLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Byb2plY3RzL25neC1zaGFyZWJ1dHRvbnMvc3JjL2xpYi9zaGFyZS1idXR0b24uZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQ1QsS0FBSyxFQUNMLE1BQU0sRUFDTixZQUFZLEVBQ1osTUFBTSxFQU1OLFlBQVksRUFHYixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFJM0MsT0FBTyxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQUUsT0FBTyxFQUFjLE1BQU0sTUFBTSxDQUFDO0FBQzlELE9BQU8sRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFHaEQsT0FBTyxFQUFxRSxZQUFZLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNqSCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sU0FBUyxDQUFDOzs7Ozs7QUFHdEMsTUFJYSxjQUFjO0lBMkR6QixZQUFZLEdBQWUsRUFDUCxLQUFXLEVBQ1gsU0FBbUIsRUFDbkIsVUFBcUIsRUFDckIsTUFBb0IsRUFDcEIsR0FBc0IsRUFDSixTQUFjO1FBTGhDLFVBQUssR0FBTCxLQUFLLENBQU07UUFDWCxjQUFTLEdBQVQsU0FBUyxDQUFVO1FBQ25CLGVBQVUsR0FBVixVQUFVLENBQVc7UUFDckIsV0FBTSxHQUFOLE1BQU0sQ0FBYztRQUNwQixRQUFHLEdBQUgsR0FBRyxDQUFtQjtRQUNKLGNBQVMsR0FBVCxTQUFTLENBQUs7UUF0RHBELGlEQUFpRDtRQUNoQyxlQUFVLEdBQUcsSUFBSSxPQUFPLEVBQVEsQ0FBQztRQUVsRCw0REFBNEQ7UUFDM0MsYUFBUSxHQUFHLElBQUksT0FBTyxFQUF5QixDQUFDO1FBaUJqRSxxRUFBcUU7UUFDNUQsZ0JBQVcsR0FBWSxJQUFJ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LENBQUM7Z0JBQy9ELE9BQU8sR0FBSSxLQUFNLElBQUssa0JBQWtCLENBQUMsVUFBVSxDQUFFLEVBQUUsQ0FBQzthQUN6RDtZQUNELE9BQU8sRUFBRSxDQUFDO1FBQ1osQ0FBQyxDQUFDO2FBQ0QsTUFBTSxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsUUFBUSxLQUFLLEVBQUUsQ0FBQzthQUNuQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDZixDQUFDOzhHQTdTVSxjQUFjLDhLQWlFTCxRQUFRO2tHQWpFakIsY0FBYzs7U0FBZCxjQUFjOzJGQUFkLGNBQWM7a0JBSjFCLFNBQVM7bUJBQUM7b0JBQ1QsUUFBUSxFQUFFLGVBQWU7b0JBQ3pCLFFBQVEsRUFBRSxhQUFhO2lCQUN4Qjs7MEJBa0VjLE1BQU07MkJBQUMsUUFBUTs0Q0FuQ04sZUFBZTtzQkFBcEMsS0FBSzt1QkFBQyxhQUFhO2dCQUdYLFdBQVc7c0JBQW5CLEtBQUs7Z0JBR0csR0FBRztzQkFBWCxLQUFLO2dCQUdHLEtBQUs7c0JBQWIsS0FBSztnQkFHRyxXQUFXO3NCQUFuQixLQUFLO2dCQUdHLEtBQUs7c0JBQWIsS0FBSztnQkFHRyxJQUFJO3NCQUFaLEtBQUs7Z0JBR0csV0FBVztzQkFBbkIsS0FBSztnQkFHSSxNQUFNO3NCQUFmLE1BQU07Z0JBR0csTUFBTTtzQkFBZixNQUFNO2dCQWdCUCxLQUFLO3NCQURKLFlBQVk7dUJBQUMsT0FBTyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgRGlyZWN0aXZlLFxyXG4gIElucHV0LFxyXG4gIE91dHB1dCxcclxuICBIb3N0TGlzdGVuZXIsXHJcbiAgSW5qZWN0LFxyXG4gIE9uSW5pdCxcclxuICBPbkNoYW5nZXMsXHJcbiAgT25EZXN0cm95LFxyXG4gIFNpbXBsZUNoYW5nZXMsXHJcbiAgU2ltcGxlQ2hhbmdlLFxyXG4gIEV2ZW50RW1pdHRlcixcclxuICBFbGVtZW50UmVmLFxyXG4gIENoYW5nZURldGVjdG9yUmVmXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IERPQ1VNRU5UIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcclxuaW1wb3J0IHsgTWV0YSB9IGZyb20gJ0Bhbmd1bGFyL3BsYXRmb3JtLWJyb3dzZXInO1xyXG5pbXBvcnQgeyBQbGF0Zm9ybSB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9wbGF0Zm9ybSc7XHJcbmltcG9ydCB7IENsaXBib2FyZCB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9jbGlwYm9hcmQnO1xyXG5pbXBvcnQgeyBFTVBUWSwgT2JzZXJ2YWJsZSwgU3ViamVjdCwgU3Vic2NyaWJlciB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyB0YWtlVW50aWwsIHRhcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuXHJcbmltcG9ydCB7IFNoYXJlU2VydmljZSB9IGZyb20gJy4vc2hhcmUuc2VydmljZSc7XHJcbmltcG9ydCB7IElTaGFyZUJ1dHRvbiwgU2hhcmVEaXJlY3RpdmVVcGRhdGVyLCBTaGFyZVBhcmFtcywgU2hhcmVQYXJhbXNGdW5jLCBTaGFyZXJNZXRob2QgfSBmcm9tICcuL3NoYXJlLm1vZGVscyc7XHJcbmltcG9ydCB7IGdldFZhbGlkVXJsIH0gZnJvbSAnLi91dGlscyc7XHJcbmltcG9ydCB7IHNoYXJlQnV0dG9uTmFtZSB9IGZyb20gJy4vc2hhcmUuZGVmYXVsdHMnO1xyXG5cclxuQERpcmVjdGl2ZSh7XHJcbiAgc2VsZWN0b3I6ICdbc2hhcmVCdXR0b25dJyxcclxuICBleHBvcnRBczogJ3NoYXJlQnV0dG9uJ1xyXG59KVxyXG5leHBvcnQgY2xhc3MgU2hhcmVEaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcywgT25EZXN0cm95IHtcclxuXHJcbiAgLyoqIFZhcmlhYmxlIHVzZWQgdG8gY2hlY2sgZm9yIHRoZSBmaW5hbCBzaGFyZXIgdXJsIChGb3IgdGVzdGluZyBvbmx5KSAqL1xyXG4gIHByaXZhdGUgX2ZpbmFsVXJsOiBzdHJpbmc7XHJcblxyXG4gIC8qKiBTaGFyZSBkaXJlY3RpdmUgZWxlbWVudCByZWYgKi9cclxuICBwcml2YXRlIHJlYWRvbmx5IF9lbDogSFRNTEJ1dHRvbkVsZW1lbnQ7XHJcblxyXG4gIC8qKiBBIHJlZiB0byBidXR0b24gY2xhc3MgLSB1c2VkIHRvIHJlbW92ZSBwcmV2aW91cyBjbGFzcyB3aGVuIHRoZSBidXR0b24gdHlwZSBpcyBjaGFuZ2VkICovXHJcbiAgcHJpdmF0ZSBfYnV0dG9uQ2xhc3M6IHN0cmluZztcclxuXHJcbiAgLyoqIFN0cmVhbSB0aGF0IGVtaXRzIHdoZW4gYnV0dG9uIGlzIGRlc3Ryb3llZCAqL1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgX2Rlc3Ryb3llZCA9IG5ldyBTdWJqZWN0PHZvaWQ+KCk7XHJcblxyXG4gIC8qKiBTdHJlYW0gdGhhdCBlbWl0IHdoZW4gc2hhcmUgYnV0dG9uIG5lZWQgdG8gYmUgdXBkYXRlZCAqL1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgX3VwZGF0ZXIgPSBuZXcgU3ViamVjdDxTaGFyZURpcmVjdGl2ZVVwZGF0ZXI+KCk7XHJcblxyXG4gIC8qKiBTaGFyZSBidXR0b24gcHJvcGVydGllcyAqL1xyXG4gIHNoYXJlQnV0dG9uOiBJU2hhcmVCdXR0b247XHJcblxyXG4gIC8qKiBTaGFyZSBidXR0b24gY29sb3IgKi9cclxuICBjb2xvcjogc3RyaW5nO1xyXG5cclxuICAvKiogU2hhcmUgYnV0dG9uIHRleHQgKi9cclxuICB0ZXh0OiBzdHJpbmc7XHJcblxyXG4gIC8qKiBTaGFyZSBidXR0b24gaWNvbiAqL1xyXG4gIGljb246IHN0cmluZyB8IHN0cmluZ1tdO1xyXG5cclxuICAvKiogU2hhcmUgYnV0dG9uIHR5cGUgKi9cclxuICBASW5wdXQoJ3NoYXJlQnV0dG9uJykgc2hhcmVCdXR0b25OYW1lOiBzaGFyZUJ1dHRvbk5hbWU7XHJcblxyXG4gIC8qKiBTZXQgbWV0YSB0YWdzIGZyb20gZG9jdW1lbnQgaGVhZCwgdXNlZnVsIHdoZW4gU0VPIGlzIHN1cHBvcnRlZCAqL1xyXG4gIEBJbnB1dCgpIGF1dG9TZXRNZXRhOiBib29sZWFuID0gdGhpcy5fc2hhcmUuY29uZmlnLmF1dG9TZXRNZXRhO1xyXG5cclxuICAvKiogU2hhcmluZyBsaW5rICovXHJcbiAgQElucHV0KCkgdXJsOiBzdHJpbmcgPSB0aGlzLl9zaGFyZS5jb25maWcudXJsO1xyXG5cclxuICAvKiogU2V0cyB0aGUgdGl0bGUgcGFyYW1ldGVyICovXHJcbiAgQElucHV0KCkgdGl0bGU6IHN0cmluZyA9IHRoaXMuX3NoYXJlLmNvbmZpZy50aXRsZTtcclxuXHJcbiAgLyoqIFNldHMgdGhlIGRlc2NyaXB0aW9uIHBhcmFtZXRlciAqL1xyXG4gIEBJbnB1dCgpIGRlc2NyaXB0aW9uOiBzdHJpbmcgPSB0aGlzLl9zaGFyZS5jb25maWcuZGVzY3JpcHRpb247XHJcblxyXG4gIC8qKiBTZXRzIHRoZSBpbWFnZSBwYXJhbWV0ZXIgZm9yIHNoYXJpbmcgb24gUGludGVyZXN0ICovXHJcbiAgQElucHV0KCkgaW1hZ2U6IHN0cmluZyA9IHRoaXMuX3NoYXJlLmNvbmZpZy5pbWFnZTtcclxuXHJcbiAgLyoqIFNldHMgdGhlIHRhZ3MgcGFyYW1ldGVyIGZvciBzaGFyaW5nIG9uIFR3aXR0ZXIgYW5kIFR1bWJsciAqL1xyXG4gIEBJbnB1dCgpIHRhZ3M6IHN0cmluZyA9IHRoaXMuX3NoYXJlLmNvbmZpZy50YWdzO1xyXG5cclxuICAvKiogU2V0cyB0aGUgZmIgbWVzc2VuZ2VyIHJlZGlyZWN0IHVybCB0byBlbmFibGUgc2hhcmluZyBvbiBNZXNzZW5nZXIgZGVza3RvcCAqL1xyXG4gIEBJbnB1dCgpIHJlZGlyZWN0VXJsOiBzdHJpbmcgPSB0aGlzLl9zaGFyZS5jb25maWcucmVkaXJlY3RVcmw7XHJcblxyXG4gIC8qKiBTdHJlYW0gdGhhdCBlbWl0cyB3aGVuIHNoYXJlIGRpYWxvZyBpcyBvcGVuZWQgKi9cclxuICBAT3V0cHV0KCkgb3BlbmVkID0gbmV3IEV2ZW50RW1pdHRlcjxzdHJpbmc+KCk7XHJcblxyXG4gIC8qKiBTdHJlYW0gdGhhdCBlbWl0cyB3aGVuIHNoYXJlIGRpYWxvZyBpcyBjbG9zZWQgKi9cclxuICBAT3V0cHV0KCkgY2xvc2VkID0gbmV3IEV2ZW50RW1pdHRlcjxzdHJpbmc+KCk7XHJcblxyXG4gIGNvbnN0cnVjdG9yKF9lbDogRWxlbWVudFJlZixcclxuICAgICAgICAgICAgICBwcml2YXRlIF9tZXRhOiBNZXRhLFxyXG4gICAgICAgICAgICAgIHByaXZhdGUgX3BsYXRmb3JtOiBQbGF0Zm9ybSxcclxuICAgICAgICAgICAgICBwcml2YXRlIF9jbGlwYm9hcmQ6IENsaXBib2FyZCxcclxuICAgICAgICAgICAgICBwcml2YXRlIF9zaGFyZTogU2hhcmVTZXJ2aWNlLFxyXG4gICAgICAgICAgICAgIHByaXZhdGUgX2NkOiBDaGFuZ2VEZXRlY3RvclJlZixcclxuICAgICAgICAgICAgICBASW5qZWN0KERPQ1VNRU5UKSBwcml2YXRlIF9kb2N1bWVudDogYW55KSB7XHJcbiAgICB0aGlzLl9lbCA9IF9lbC5uYXRpdmVFbGVtZW50O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2hhcmUgdGhlIGxpbmtcclxuICAgKi9cclxuICBASG9zdExpc3RlbmVyKCdjbGljaycpXHJcbiAgc2hhcmUoKSB7XHJcbiAgICAvLyBBdm9pZCBTU1IgZXJyb3JcclxuICAgIGlmICh0aGlzLl9wbGF0Zm9ybS5pc0Jyb3dzZXIgJiYgdGhpcy5zaGFyZUJ1dHRvbikge1xyXG4gICAgICAvLyBQcmVwYXJlIHNoYXJlciB1cmwgcGFyYW1zXHJcbiAgICAgIGNvbnN0IHBhcmFtczogU2hhcmVQYXJhbXMgPSB0aGlzLmF1dG9TZXRNZXRhID8gdGhpcy5nZXRQYXJhbXNGcm9tTWV0YVRhZ3MoKSA6IHRoaXMuZ2V0UGFyYW1zRnJvbUlucHV0cygpO1xyXG5cclxuICAgICAgLy8gUHJlcGFyZSBzaGFyZSBidXR0b24gY2xpY2tcclxuICAgICAgY29uc3QgY2xpY2sgPSB0aGlzLnNoYXJlQnV0dG9uLnNoYXJlID8gdGhpcy5vcGVuKHBhcmFtcykgOiB0aGlzLnNoYXJlQnV0dG9uLmZ1bmMoe1xyXG4gICAgICAgIHBhcmFtcyxcclxuICAgICAgICBkYXRhOiB0aGlzLnNoYXJlQnV0dG9uLmRhdGEsXHJcbiAgICAgICAgY2xpcGJvYXJkOiB0aGlzLl9jbGlwYm9hcmQsXHJcbiAgICAgICAgdXBkYXRlcjogdGhpcy5fdXBkYXRlclxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGNsaWNrLnBpcGUodGFrZVVudGlsKHRoaXMuX2Rlc3Ryb3llZCkpLnN1YnNjcmliZSgpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29uc29sZS53YXJuKGAkeyB0aGlzLnRleHQgfSBidXR0b24gaXMgbm90IGNvbXBhdGlibGUgb24gdGhpcyBQbGF0Zm9ybWApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICAvLyBUaGlzIHN0cmVhbSBpcyBtYWlubHkgdXNlZCB0byB1cGRhdGUgdGhlIGNvcHkgYnV0dG9uIHRleHQgYW5kIGljb24gd2hlbiBpdCBpcyBiZWluZyBjbGlja2VkXHJcbiAgICB0aGlzLl91cGRhdGVyLnBpcGUoXHJcbiAgICAgIHRhcCgoZGF0YTogYW55KSA9PiB7XHJcbiAgICAgICAgdGhpcy5pY29uID0gZGF0YS5pY29uO1xyXG4gICAgICAgIHRoaXMudGV4dCA9IGRhdGEudGV4dDtcclxuICAgICAgICB0aGlzLl9lbC5zdHlsZS5wb2ludGVyRXZlbnRzID0gZGF0YS5kaXNhYmxlZCA/ICdub25lJyA6ICdhdXRvJztcclxuICAgICAgICB0aGlzLl9jZC5tYXJrRm9yQ2hlY2soKTtcclxuICAgICAgfSksXHJcbiAgICAgIHRha2VVbnRpbCh0aGlzLl9kZXN0cm95ZWQpXHJcbiAgICApLnN1YnNjcmliZSgpO1xyXG4gIH1cclxuXHJcbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xyXG4gICAgLy8gQXZvaWQgU1NSIGVycm9yXHJcbiAgICBpZiAodGhpcy5fcGxhdGZvcm0uaXNCcm93c2VyKSB7XHJcblxyXG4gICAgICAvLyBDcmVhdGUgc2hhcmUgYnV0dG9uXHJcbiAgICAgIGlmICh0aGlzLl9zaGFyZUJ1dHRvbkNoYW5nZWQoY2hhbmdlcy5zaGFyZUJ1dHRvbk5hbWUpKSB7XHJcbiAgICAgICAgdGhpcy5fY3JlYXRlU2hhcmVCdXR0b24oKTtcclxuICAgICAgfVxyXG4gICAgICAvLyBQcmVwYXJlIHNoYXJlIHVybFxyXG4gICAgICBpZiAodGhpcy5fdXJsQ2hhbmdlZChjaGFuZ2VzLnVybCkpIHtcclxuICAgICAgICB0aGlzLnVybCA9IGdldFZhbGlkVXJsKFxyXG4gICAgICAgICAgdGhpcy5hdXRvU2V0TWV0YVxyXG4gICAgICAgICAgICA/IHRoaXMudXJsIHx8IHRoaXMuX2dldE1ldGFUYWdDb250ZW50KCdvZzp1cmwnKVxyXG4gICAgICAgICAgICA6IHRoaXMudXJsLFxyXG4gICAgICAgICAgdGhpcy5fZG9jdW1lbnQuZGVmYXVsdFZpZXcubG9jYXRpb24uaHJlZlxyXG4gICAgICAgICk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIG5nT25EZXN0cm95KCkge1xyXG4gICAgdGhpcy5fZGVzdHJveWVkLm5leHQoKTtcclxuICAgIHRoaXMuX2Rlc3Ryb3llZC5jb21wbGV0ZSgpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBfY3JlYXRlU2hhcmVCdXR0b24oKSB7XHJcbiAgICBjb25zdCBidXR0b246IElTaGFyZUJ1dHRvbiA9IHRoaXMuX3NoYXJlLmNvbmZpZy5wcm9wW3RoaXMuc2hhcmVCdXR0b25OYW1lXTtcclxuICAgIGlmIChidXR0b24pIHtcclxuICAgICAgLy8gU2V0IHNoYXJlIGJ1dHRvbiBwcm9wZXJ0aWVzXHJcbiAgICAgIHRoaXMuc2hhcmVCdXR0b24gPSBidXR0b247XHJcblxyXG4gICAgICAvLyBSZW1vdmUgcHJldmlvdXMgYnV0dG9uIGNsYXNzXHJcbiAgICAgIHRoaXMuX2VsLmNsYXNzTGlzdC5yZW1vdmUoYHNiLSR7IHRoaXMuX2J1dHRvbkNsYXNzIH1gKTtcclxuXHJcbiAgICAgIC8vIEFkZCBuZXcgYnV0dG9uIGNsYXNzXHJcbiAgICAgIHRoaXMuX2VsLmNsYXNzTGlzdC5hZGQoYHNiLSR7IHRoaXMuc2hhcmVCdXR0b25OYW1lIH1gKTtcclxuXHJcbiAgICAgIC8vIFNldCBidXR0b24gY3NzIGNvbG9yIHZhcmlhYmxlXHJcbiAgICAgIHRoaXMuX2VsLnN0eWxlLnNldFByb3BlcnR5KCctLWJ1dHRvbi1jb2xvcicsIHRoaXMuc2hhcmVCdXR0b24uY29sb3IpO1xyXG5cclxuICAgICAgLy8gS2VlcCBhIGNvcHkgb2YgdGhlIGNsYXNzIGZvciBmdXR1cmUgcmVwbGFjZW1lbnRcclxuICAgICAgdGhpcy5fYnV0dG9uQ2xhc3MgPSB0aGlzLnNoYXJlQnV0dG9uTmFtZTtcclxuXHJcbiAgICAgIHRoaXMuY29sb3IgPSB0aGlzLnNoYXJlQnV0dG9uLmNvbG9yO1xyXG4gICAgICB0aGlzLnRleHQgPSB0aGlzLnNoYXJlQnV0dG9uLnRleHQ7XHJcbiAgICAgIHRoaXMuaWNvbiA9IHRoaXMuc2hhcmVCdXR0b24uaWNvbjtcclxuXHJcbiAgICAgIC8vIFNldCBhcmlhLWxhYmVsIGF0dHJpYnV0ZVxyXG4gICAgICB0aGlzLl9lbC5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCBidXR0b24uYXJpYUxhYmVsKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoYFtTaGFyZUJ1dHRvbnNdOiBUaGUgc2hhcmUgYnV0dG9uICckeyB0aGlzLnNoYXJlQnV0dG9uTmFtZSB9JyBkb2VzIG5vdCBleGlzdCFgKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCBtZXRhIHRhZyBjb250ZW50XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBfZ2V0TWV0YVRhZ0NvbnRlbnQoa2V5OiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgY29uc3QgbWV0YVVzaW5nUHJvcGVydHk6IEhUTUxNZXRhRWxlbWVudCA9IHRoaXMuX21ldGEuZ2V0VGFnKGBwcm9wZXJ0eT1cIiR7IGtleSB9XCJgKTtcclxuICAgIGlmIChtZXRhVXNpbmdQcm9wZXJ0eSkge1xyXG4gICAgICByZXR1cm4gbWV0YVVzaW5nUHJvcGVydHkuZ2V0QXR0cmlidXRlKCdjb250ZW50Jyk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBtZXRhVXNpbmdOYW1lOiBIVE1MTWV0YUVsZW1lbnQgPSB0aGlzLl9tZXRhLmdldFRhZyhgbmFtZT1cIiR7IGtleSB9XCJgKTtcclxuICAgIGlmIChtZXRhVXNpbmdOYW1lKSB7XHJcbiAgICAgIHJldHVybiBtZXRhVXNpbmdOYW1lLmdldEF0dHJpYnV0ZSgnY29udGVudCcpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBfc2hhcmVCdXR0b25DaGFuZ2VkKGNoYW5nZTogU2ltcGxlQ2hhbmdlKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gY2hhbmdlICYmIChjaGFuZ2UuZmlyc3RDaGFuZ2UgfHwgY2hhbmdlLnByZXZpb3VzVmFsdWUgIT09IGNoYW5nZS5jdXJyZW50VmFsdWUpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBfdXJsQ2hhbmdlZChjaGFuZ2U6IFNpbXBsZUNoYW5nZSk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuICF0aGlzLnVybCB8fCAoY2hhbmdlICYmIGNoYW5nZS5wcmV2aW91c1ZhbHVlICE9PSBjaGFuZ2UuY3VycmVudFZhbHVlKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCBzaGFyZSBwYXJhbXMgZnJvbSBtZXRhIHRhZ3MgZmlyc3QgYW5kIGZhbGxiYWNrIHRvIHVzZXIgaW5wdXRzXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXRQYXJhbXNGcm9tTWV0YVRhZ3MoKTogU2hhcmVQYXJhbXMge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgdXJsOiB0aGlzLnVybCxcclxuICAgICAgdGl0bGU6IHRoaXMudGl0bGUgfHwgdGhpcy5fZ2V0TWV0YVRhZ0NvbnRlbnQoJ29nOnRpdGxlJyksXHJcbiAgICAgIGRlc2NyaXB0aW9uOiB0aGlzLmRlc2NyaXB0aW9uIHx8IHRoaXMuX2dldE1ldGFUYWdDb250ZW50KCdvZzpkZXNjcmlwdGlvbicpLFxyXG4gICAgICBpbWFnZTogdGhpcy5pbWFnZSB8fCB0aGlzLl9nZXRNZXRhVGFnQ29udGVudCgnb2c6aW1hZ2UnKSxcclxuICAgICAgdmlhOiB0aGlzLl9zaGFyZS5jb25maWcudHdpdHRlckFjY291bnQsXHJcbiAgICAgIHRhZ3M6IHRoaXMudGFncyxcclxuICAgICAgYXBwSWQ6IHRoaXMuX3NoYXJlLmNvbmZpZy5hcHBJZCB8fCB0aGlzLl9nZXRNZXRhVGFnQ29udGVudCgnZmI6YXBwX2lkJyksXHJcbiAgICAgIHJlZGlyZWN0VXJsOiB0aGlzLnJlZGlyZWN0VXJsIHx8IHRoaXMudXJsXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IHNoYXJlIHBhcmFtcyBmcm9tIHVzZXIgaW5wdXRzXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXRQYXJhbXNGcm9tSW5wdXRzKCk6IFNoYXJlUGFyYW1zIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHVybDogdGhpcy51cmwsXHJcbiAgICAgIHRpdGxlOiB0aGlzLnRpdGxlLFxyXG4gICAgICBkZXNjcmlwdGlvbjogdGhpcy5kZXNjcmlwdGlvbixcclxuICAgICAgaW1hZ2U6IHRoaXMuaW1hZ2UsXHJcbiAgICAgIHRhZ3M6IHRoaXMudGFncyxcclxuICAgICAgdmlhOiB0aGlzLl9zaGFyZS5jb25maWcudHdpdHRlckFjY291bnQsXHJcbiAgICAgIGFwcElkOiB0aGlzLl9zaGFyZS5jb25maWcuYXBwSWQsXHJcbiAgICAgIHJlZGlyZWN0VXJsOiB0aGlzLnJlZGlyZWN0VXJsIHx8IHRoaXMudXJsXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBvcGVuKHBhcmFtczogU2hhcmVQYXJhbXMpOiBPYnNlcnZhYmxlPHZvaWQ+IHtcclxuICAgIC8vIFNldCBzaGFyZXIgbGluayBiYXNlZCBvbiB1c2VyJ3MgZGV2aWNlXHJcbiAgICBsZXQgc2hhcmVyTGluazogc3RyaW5nO1xyXG4gICAgaWYgKHRoaXMuX3BsYXRmb3JtLklPUyAmJiB0aGlzLnNoYXJlQnV0dG9uLnNoYXJlLmlvcykge1xyXG4gICAgICBzaGFyZXJMaW5rID0gdGhpcy5zaGFyZUJ1dHRvbi5zaGFyZS5pb3M7XHJcbiAgICB9IGVsc2UgaWYgKHRoaXMuX3BsYXRmb3JtLkFORFJPSUQgJiYgdGhpcy5zaGFyZUJ1dHRvbi5zaGFyZS5hbmRyb2lkKSB7XHJcbiAgICAgIHNoYXJlckxpbmsgPSB0aGlzLnNoYXJlQnV0dG9uLnNoYXJlLmFuZHJvaWQ7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBzaGFyZXJMaW5rID0gdGhpcy5zaGFyZUJ1dHRvbi5zaGFyZS5kZXNrdG9wO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChzaGFyZXJMaW5rKSB7XHJcbiAgICAgIC8vIFNldCBzaGFyZXIgbGluayBwYXJhbXNcclxuICAgICAgdGhpcy5fZmluYWxVcmwgPSBzaGFyZXJMaW5rICsgdGhpcy5fc2VyaWFsaXplUGFyYW1zKHBhcmFtcyk7XHJcblxyXG4gICAgICAvLyBMb2cgdGhlIHNoYXJlciBsaW5rIGluIGRlYnVnIG1vZGVcclxuICAgICAgaWYgKHRoaXMuX3NoYXJlLmNvbmZpZy5kZWJ1Zykge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdbREVCVUcgU0hBUkUgQlVUVE9OXTogJywgdGhpcy5fZmluYWxVcmwpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBPcGVuIHRoZSBzaGFyZSB3aW5kb3dcclxuICAgICAgLy8gVGhlcmUgYXJlIHR3byBtZXRob2RzIGF2YWlsYWJsZSBmb3Igb3BlbmluZyB0aGUgc2hhcmUgd2luZG93OlxyXG4gICAgICAvLyAxLiBVc2luZyBhIHJlYWwgYW5jaG9yXHJcbiAgICAgIC8vIDIuIFVzaW5nIHdpbmRvdy5vcGVuXHJcbiAgICAgIGNvbnN0IHNoYXJlck1ldGhvZCA9IHRoaXMuc2hhcmVCdXR0b24ubWV0aG9kIHx8IHRoaXMuX3NoYXJlLmNvbmZpZy5zaGFyZXJNZXRob2Q7XHJcbiAgICAgIGNvbnN0IHNoYXJlclRhcmdldCA9IHRoaXMuc2hhcmVCdXR0b24udGFyZ2V0IHx8IHRoaXMuX3NoYXJlLmNvbmZpZy5zaGFyZXJUYXJnZXQ7XHJcblxyXG4gICAgICBzd2l0Y2ggKHNoYXJlck1ldGhvZCkge1xyXG5cclxuICAgICAgICBjYXNlIFNoYXJlck1ldGhvZC5BbmNob3I6XHJcbiAgICAgICAgICBjb25zdCBsaW5rRWxlbWVudDogSFRNTExpbmtFbGVtZW50ID0gdGhpcy5fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xyXG4gICAgICAgICAgLy8gTWFrZSBpdCBvcGVuIGluIGEgbmV3IHRhYi93aW5kb3cgKGRlcGVuZHMgb24gdXNlcidzIGJyb3dzZXIgY29uZmlndXJhdGlvbilcclxuICAgICAgICAgIGxpbmtFbGVtZW50LnNldEF0dHJpYnV0ZSgndGFyZ2V0Jywgc2hhcmVyVGFyZ2V0KTtcclxuXHJcbiAgICAgICAgICAvLyBQcmV2ZW50IHNlY3VyaXR5IHZ1bG5lcmFiaWxpdHkgaHR0cHM6Ly9tZWRpdW0uY29tL0BqaXRiaXQvdGFyZ2V0LWJsYW5rLXRoZS1tb3N0LXVuZGVyZXN0aW1hdGVkLXZ1bG5lcmFiaWxpdHktZXZlci05NmUzMjgzMDFmNGNcclxuICAgICAgICAgIGxpbmtFbGVtZW50LnNldEF0dHJpYnV0ZSgncmVsJywgJ25vb3BlbmVyIG5vcmVmZXJyZXInKTtcclxuICAgICAgICAgIGxpbmtFbGVtZW50LmhyZWYgPSB0aGlzLl9maW5hbFVybDtcclxuICAgICAgICAgIGxpbmtFbGVtZW50LmNsaWNrKCk7XHJcbiAgICAgICAgICBsaW5rRWxlbWVudC5yZW1vdmUoKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICBjYXNlIFNoYXJlck1ldGhvZC5XaW5kb3c6XHJcbiAgICAgICAgICAvLyBPcGVuIGxpbmsgdXNpbmcgV2luZG93IG9iamVjdFxyXG4gICAgICAgICAgY29uc3Qgb3BlbldpbmRvdyA9IHRoaXMuX3NoYXJlLmNvbmZpZy53aW5kb3dPYmpbdGhpcy5fc2hhcmUuY29uZmlnLndpbmRvd0Z1bmNOYW1lXTtcclxuICAgICAgICAgIGNvbnN0IHBvcFVwV2luZG93ID0gb3BlbldpbmRvdyh0aGlzLl9maW5hbFVybCwgc2hhcmVyVGFyZ2V0LCB0aGlzLl9zaGFyZS53aW5kb3dTaXplKTtcclxuXHJcbiAgICAgICAgICAvLyBQcmV2ZW50IHNlY3VyaXR5IHZ1bG5lcmFiaWxpdHkgaHR0cHM6Ly9tZWRpdW0uY29tL0BqaXRiaXQvdGFyZ2V0LWJsYW5rLXRoZS1tb3N0LXVuZGVyZXN0aW1hdGVkLXZ1bG5lcmFiaWxpdHktZXZlci05NmUzMjgzMDFmNGNcclxuICAgICAgICAgIHRoaXMuX3NoYXJlLmNvbmZpZy53aW5kb3dPYmoub3BlbmVyID0gbnVsbDtcclxuXHJcbiAgICAgICAgICAvLyBSZXNvbHZlIHdoZW4gc2hhcmUgZGlhbG9nIGlzIGNsb3NlZFxyXG4gICAgICAgICAgaWYgKHBvcFVwV2luZG93KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgT2JzZXJ2YWJsZTx2b2lkPigoc3ViOiBTdWJzY3JpYmVyPHZvaWQ+KSA9PiB7XHJcbiAgICAgICAgICAgICAgY29uc3QgcG9sbFRpbWVyID0gdGhpcy5fZG9jdW1lbnQuZGVmYXVsdFZpZXcuc2V0SW50ZXJ2YWwoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHBvcFVwV2luZG93LmNsb3NlZCkge1xyXG4gICAgICAgICAgICAgICAgICB0aGlzLl9kb2N1bWVudC5kZWZhdWx0Vmlldy5jbGVhckludGVydmFsKHBvbGxUaW1lcik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAvLyBFbWl0IHdoZW4gc2hhcmUgd2luZG93cyBpcyBjbG9zZWRcclxuICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZWQuZW1pdCh0aGlzLnNoYXJlQnV0dG9uTmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgIHN1Yi5uZXh0KCk7XHJcbiAgICAgICAgICAgICAgICAgIHN1Yi5jb21wbGV0ZSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH0sIDIwMCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIEVtaXQgd2hlbiBzaGFyZSB3aW5kb3cgaXMgb3BlbmVkXHJcbiAgICAgIHRoaXMub3BlbmVkLmVtaXQodGhpcy5zaGFyZUJ1dHRvbk5hbWUpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIEVNUFRZO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBfc2VyaWFsaXplUGFyYW1zKHBhcmFtczogU2hhcmVQYXJhbXMpOiBzdHJpbmcge1xyXG4gICAgcmV0dXJuIE9iamVjdC5lbnRyaWVzKHRoaXMuc2hhcmVCdXR0b24ucGFyYW1zKVxyXG4gICAgICAubWFwKChba2V5LCB2YWx1ZV0pID0+IHtcclxuICAgICAgICAvLyBDaGVjayBpZiBzaGFyZSBidXR0b24gcGFyYW0gaGFzIGEgbWFwIGZ1bmN0aW9uXHJcbiAgICAgICAgY29uc3QgcGFyYW1GdW5jOiBTaGFyZVBhcmFtc0Z1bmMgPSB0aGlzLnNoYXJlQnV0dG9uLnBhcmFtc0Z1bmMgPyB0aGlzLnNoYXJlQnV0dG9uLnBhcmFtc0Z1bmNba2V5XSA6IG51bGw7XHJcblxyXG4gICAgICAgIGlmIChwYXJhbXNba2V5XSB8fCBwYXJhbUZ1bmMpIHtcclxuICAgICAgICAgIGNvbnN0IHBhcmFtVmFsdWUgPSBwYXJhbUZ1bmMgPyBwYXJhbUZ1bmMocGFyYW1zKSA6IHBhcmFtc1trZXldO1xyXG4gICAgICAgICAgcmV0dXJuIGAkeyB2YWx1ZSB9PSR7IGVuY29kZVVSSUNvbXBvbmVudChwYXJhbVZhbHVlKSB9YDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgICB9KVxyXG4gICAgICAuZmlsdGVyKHVybFBhcmFtID0+IHVybFBhcmFtICE9PSAnJylcclxuICAgICAgLmpvaW4oJyYnKTtcclxuICB9XHJcbn1cclxuIl19